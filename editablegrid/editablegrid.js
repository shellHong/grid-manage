function _$(e){return document.getElementById(e)}function Column(e){var t={name:"",label:"",editable:!0,renderable:!0,datatype:"string",unit:null,precision:-1,nansymbol:"",decimal_point:",",thousands_separator:".",unit_before_number:!1,bar:!0,hidden:!1,headerRenderer:null,headerEditor:null,cellRenderer:null,cellEditor:null,cellValidators:[],enumProvider:null,optionValues:null,optionValuesForRender:null,columnIndex:-1};for(var r in t)this[r]="undefined"==typeof e||"undefined"==typeof e[r]?t[r]:e[r]}function EnumProvider(e){this.getOptionValuesForRender=function(e,t,r){return null},this.getOptionValuesForEdit=function(e,t,r){return null};for(var t in e)this[t]=e[t]}function EditableGrid(e,t){"undefined"!=typeof e&&""==e.replace(/\s+/g,"")&&console.error("EditableGrid() : parameter [name] cannot be empty."),e&&this.init(e,t)}Column.prototype.getOptionValuesForRender=function(e){if(!this.enumProvider)return console.log("getOptionValuesForRender called on column "+this.name+" but there is no EnumProvider"),null;var t=this.enumProvider.getOptionValuesForRender(this.editablegrid,this,e);return t?t:this.optionValuesForRender},Column.prototype.getOptionValuesForEdit=function(e){if(!this.enumProvider)return console.log("getOptionValuesForEdit called on column "+this.name+" but there is no EnumProvider"),null;var t=this.enumProvider.getOptionValuesForEdit(this.editablegrid,this,e);return t?this.editablegrid._convertOptions(t):this.optionValues},Column.prototype.isValid=function(e){for(var t=0;t<this.cellValidators.length;t++)if(!this.cellValidators[t].isValid(e))return!1;return!0},Column.prototype.isNumerical=function(){return"double"==this.datatype||"integer"==this.datatype},EditableGrid.prototype.enableSort=!0,EditableGrid.prototype.enableStore=!0,EditableGrid.prototype.doubleclick=!1,EditableGrid.prototype.editmode="absolute",EditableGrid.prototype.editorzoneid="",EditableGrid.prototype.allowSimultaneousEdition=!1,EditableGrid.prototype.saveOnBlur=!0,EditableGrid.prototype.invalidClassName="invalid",EditableGrid.prototype.ignoreLastRow=!1,EditableGrid.prototype.caption=null,EditableGrid.prototype.dateFormat="EU",EditableGrid.prototype.shortMonthNames=null,EditableGrid.prototype.smartColorsBar=["#dc243c","#4040f6","#00f629","#efe100","#f93fb1","#6f8183","#111111"],EditableGrid.prototype.smartColorsPie=["#FF0000","#00FF00","#0000FF","#FFD700","#FF00FF","#00FFFF","#800080"],EditableGrid.prototype.pageSize=0,EditableGrid.prototype.serverSide=!1,EditableGrid.prototype.pageCount=0,EditableGrid.prototype.totalRowCount=0,EditableGrid.prototype.unfilteredRowCount=0,EditableGrid.prototype.paginatorAttributes=null,EditableGrid.prototype.lastURL=null,EditableGrid.prototype.init=function(e,t){if(("string"!=typeof e||"object"!=typeof t&&"undefined"!=typeof t)&&alert("The EditableGrid constructor takes two arguments:\n- name (string)\n- config (object)\n\nGot instead "+typeof e+" and "+typeof t+"."),"undefined"!=typeof t)for(var r in t)this[r]=t[r];if(this.Browser={IE:!(!window.attachEvent||navigator.userAgent.indexOf("Opera")!==-1),Opera:navigator.userAgent.indexOf("Opera")>-1,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")===-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/)},"function"!=typeof this.detectDir){var n=new Error;alert("Who is calling me now ? "+n.stack)}this.name=e,this.columns=[],this.data=[],this.dataUnfiltered=null,this.xmlDoc=null,this.sortedColumnName=-1,this.sortDescending=!1,this.baseUrl=this.detectDir(),this.nbHeaderRows=1,this.lastSelectedRowIndex=-1,this.currentPageIndex=0,this.currentFilter=null,this.currentContainerid=null,this.currentClassName=null,this.currentTableid=null,this.enableSort&&("undefined"!=typeof t&&"undefined"!=typeof t.sortIconUp?(this.sortUpElement=new Image,this.sortUpElement.src=t.sortIconUp):(this.sortUpElement=document.createElement("span"),this.sortUpElement.innerHTML="&#8593;"),"undefined"!=typeof t&&"undefined"!=typeof t.sortIconDown?(this.sortDownElement=new Image,this.sortDownElement.src=t.sortIconDown):(this.sortDownElement=document.createElement("span"),this.sortDownElement.innerHTML="&#8595;")),this.currentPageIndex=this.localisset("pageIndex")?parseInt(this.localget("pageIndex")):0,this.sortedColumnName=this.localisset("sortColumnIndexOrName")?this.localget("sortColumnIndexOrName"):-1,this.sortDescending=!(!this.localisset("sortColumnIndexOrName")||!this.localisset("sortDescending"))&&"true"==this.localget("sortDescending"),this.currentFilter=this.localisset("filter")?this.localget("filter"):null},EditableGrid.prototype.tableLoaded=function(){},EditableGrid.prototype.chartRendered=function(){},EditableGrid.prototype.tableRendered=function(e,t,r){},EditableGrid.prototype.tableSorted=function(e,t){},EditableGrid.prototype.tableFiltered=function(){},EditableGrid.prototype.openedCellEditor=function(e,t){},EditableGrid.prototype.modelChanged=function(e,t,r,n,i){},EditableGrid.prototype.rowSelected=function(e,t){},EditableGrid.prototype.isHeaderEditable=function(e,t){return!1},EditableGrid.prototype.isEditable=function(e,t){return!0},EditableGrid.prototype.readonlyWarning=function(){},EditableGrid.prototype.rowRemoved=function(e,t){},EditableGrid.prototype.loadXML=function(e,t,r){this.lastURL=e;var n=this;if(window.ActiveXObject)this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.onreadystatechange=function(){4==n.xmlDoc.readyState&&(n.processXML(),n._callback("xml",t))},this.xmlDoc.load(this._addUrlParameters(e,r));else if(window.XMLHttpRequest)this.xmlDoc=new XMLHttpRequest,this.xmlDoc.onreadystatechange=function(){if(4==this.readyState){if(n.xmlDoc=this.responseXML,!n.xmlDoc)return console.error("Could not load XML from url '"+e+"'"),!1;n.processXML(),n._callback("xml",t)}},this.xmlDoc.open("GET",this._addUrlParameters(e,r),!0),this.xmlDoc.send("");else{if(!document.implementation||!document.implementation.createDocument)return alert("Cannot load a XML url with this browser!"),!1;this.xmlDoc=document.implementation.createDocument("","",null),this.xmlDoc.onload=function(){n.processXML(),n._callback("xml",t)},this.xmlDoc.load(this._addUrlParameters(e,r))}return!0},EditableGrid.prototype.loadXMLFromString=function(e){if(window.DOMParser){var t=new DOMParser;this.xmlDoc=t.parseFromString(e,"application/xml")}else this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.async="false",this.xmlDoc.loadXML(e);this.processXML()},EditableGrid.prototype.processXML=function(){with(this){this.data=[],this.dataUnfiltered=null,this.table=null;var metadata=xmlDoc.getElementsByTagName("metadata");if(metadata&&metadata.length>=1){this.columns=[];for(var columnDeclarations=metadata[0].getElementsByTagName("column"),i=0;i<columnDeclarations.length;i++){var col=columnDeclarations[i],datatype=col.getAttribute("datatype"),optionValuesForRender=null,optionValues=null,enumValues=col.getElementsByTagName("values");if(enumValues.length>0){optionValues=[],optionValuesForRender={};var enumGroups=enumValues[0].getElementsByTagName("group");if(enumGroups.length>0)for(var g=0;g<enumGroups.length;g++){var groupOptionValues=[];enumValues=enumGroups[g].getElementsByTagName("value");for(var v=0;v<enumValues.length;v++){var _value=enumValues[v].getAttribute("value"),_label=enumValues[v].firstChild?enumValues[v].firstChild.nodeValue:"";optionValuesForRender[_value]=_label,groupOptionValues.push({value:_value,label:_label})}optionValues.push({label:enumGroups[g].getAttribute("label"),values:groupOptionValues})}else{enumValues=enumValues[0].getElementsByTagName("value");for(var v=0;v<enumValues.length;v++){var _value=enumValues[v].getAttribute("value"),_label=enumValues[v].firstChild?enumValues[v].firstChild.nodeValue:"";optionValuesForRender[_value]=_label,optionValues.push({value:_value,label:_label})}}}columns.push(new Column({name:col.getAttribute("name"),label:"string"==typeof col.getAttribute("label")?col.getAttribute("label"):col.getAttribute("name"),datatype:col.getAttribute("datatype")?col.getAttribute("datatype"):"string",editable:"true"==col.getAttribute("editable"),bar:!col.getAttribute("bar")||"true"==col.getAttribute("bar"),hidden:!!col.getAttribute("hidden")&&"true"==col.getAttribute("hidden"),optionValuesForRender:optionValuesForRender,optionValues:optionValues}))}processColumns()}var paginator=xmlDoc.getElementsByTagName("paginator");paginator&&paginator.length>=1&&(this.paginatorAttributes=null,this.pageCount=paginator[0].getAttribute("pagecount"),this.totalRowCount=paginator[0].getAttribute("totalrowcount"),this.unfilteredRowCount=paginator[0].getAttribute("unfilteredrowcount"));for(var defaultRowId=1,rows=xmlDoc.getElementsByTagName("row"),i=0;i<rows.length;i++){for(var cellValues={},cols=rows[i].getElementsByTagName("column"),j=0;j<cols.length;j++){var colname=cols[j].getAttribute("name");colname||(j>=columns.length?console.error("You defined too many columns for row "+(i+1)):colname=columns[j].name),cellValues[colname]=cols[j].firstChild?cols[j].firstChild.nodeValue:""}for(var rowData={visible:!0,originalIndex:i,id:null!==rows[i].getAttribute("id")?rows[i].getAttribute("id"):defaultRowId++},attrIndex=0;attrIndex<rows[i].attributes.length;attrIndex++){var node=rows[i].attributes.item(attrIndex);"id"!=node.nodeName&&(rowData[node.nodeName]=node.nodeValue)}rowData.columns=[];for(var c=0;c<columns.length;c++){var cellValue=columns[c].name in cellValues?cellValues[columns[c].name]:"";rowData.columns.push(getTypedValue(c,cellValue))}data.push(rowData)}}return!0},EditableGrid.prototype.loadJSON=function(e,t,r){this.lastURL=e;var n=this;if(!window.XMLHttpRequest)return alert("Cannot load a JSON url with this browser!"),!1;var i=new XMLHttpRequest;return i.onreadystatechange=function(){if(4==this.readyState){if(!this.responseText)return console.error("Could not load JSON from url '"+e+"'"),!1;if(!n.processJSON(this.responseText))return console.error("Invalid JSON data obtained from url '"+e+"'"),!1;n._callback("json",t)}},i.open("GET",this._addUrlParameters(e,r),!0),i.send(""),!0},EditableGrid.prototype._addUrlParameters=function(e,t){var r=e.indexOf("?")>=0?"&":"?";return e+=r+(new Date).getTime(),this.serverSide?e+"&page="+(this.currentPageIndex+1)+"&filter="+(this.currentFilter?encodeURIComponent(this.currentFilter):"")+"&sort="+(this.sortedColumnName&&this.sortedColumnName!=-1?encodeURIComponent(this.sortedColumnName):"")+"&asc="+(this.sortDescending?0:1)+(t?"&data_only=1":""):e},EditableGrid.prototype._callback=function(e,t){t?t.call(this):(this.serverSide&&(this.refreshGrid=function(t){var r=function(){EditableGrid.prototype.refreshGrid.call(this)},n="xml"==e?this.loadXML:this.loadJSON;n.call(this,t||this.lastURL,r,!0)}),this.tableLoaded())},EditableGrid.prototype.loadJSONFromString=function(e){return this.processJSON(e)},EditableGrid.prototype.load=function(e){return this.processJSON(e)},EditableGrid.prototype.update=function(e){if(e.data)for(var t=0;t<e.data.length;t++){var r=e.data[t];if(r.id&&r.values){var n=this.getRowIndex(r.id),i=this.data[n];if("[object Array]"!==Object.prototype.toString.call(r.values))cellValues=r.values;else{cellValues={};for(var o=0;o<r.values.length&&o<this.columns.length;o++)cellValues[this.columns[o].name]=r.values[o]}for(var a in r)"id"!=a&&"values"!=a&&(i[a]=r[a]);i.columns=[];for(var l=0;l<this.columns.length;l++){var d=this.columns[l].name in cellValues?cellValues[this.columns[l].name]:"";i.columns.push(this.getTypedValue(l,d))}for(var s=this.getRow(n),o=0;o<s.cells.length&&o<this.columns.length;o++)this.columns[o].renderable&&this.columns[o].cellRenderer._render(n,o,s.cells[o],this.getValueAt(n,o));this.tableRendered(this.currentContainerid,this.currentClassName,this.currentTableid)}}},EditableGrid.prototype.processJSON=function(jsonData){if("string"==typeof jsonData&&(jsonData=eval("("+jsonData+")")),!jsonData)return!1;if(this.data=[],this.dataUnfiltered=null,this.table=null,jsonData.metadata){this.columns=[];for(var c=0;c<jsonData.metadata.length;c++){var columndata=jsonData.metadata[c],optionValues=columndata.values?this._convertOptions(columndata.values):null,optionValuesForRender=null;if(optionValues)for(var optionValuesForRender={},optionIndex=0;optionIndex<optionValues.length;optionIndex++){var optionValue=optionValues[optionIndex];if("object"==typeof optionValue.values)for(var groupOptionIndex=0;groupOptionIndex<optionValue.values.length;groupOptionIndex++){var groupOptionValue=optionValue.values[groupOptionIndex];optionValuesForRender[groupOptionValue.value]=groupOptionValue.label}else optionValuesForRender[optionValue.value]=optionValue.label}this.columns.push(new Column({name:columndata.name,label:columndata.label?columndata.label:columndata.name,datatype:columndata.datatype?columndata.datatype:"string",editable:!!columndata.editable,bar:"undefined"==typeof columndata.bar||(columndata.bar||!1),hidden:"undefined"!=typeof columndata.hidden&&!!columndata.hidden,optionValuesForRender:optionValuesForRender,optionValues:optionValues}))}this.processColumns()}jsonData.paginator&&(this.paginatorAttributes=jsonData.paginator,this.pageCount=jsonData.paginator.pagecount,this.totalRowCount=jsonData.paginator.totalrowcount,this.unfilteredRowCount=jsonData.paginator.unfilteredrowcount);var defaultRowId=1;if(jsonData.data)for(var i=0;i<jsonData.data.length;i++){var row=jsonData.data[i];if(row.values){if("[object Array]"!==Object.prototype.toString.call(row.values))cellValues=row.values;else{cellValues={};for(var j=0;j<row.values.length&&j<this.columns.length;j++)cellValues[this.columns[j].name]=row.values[j]}var rowData={visible:!0,originalIndex:i,id:void 0!==row.id&&null!==row.id?row.id:defaultRowId++};for(var attributeName in row)"id"!=attributeName&&"values"!=attributeName&&(rowData[attributeName]=row[attributeName]);rowData.columns=[];for(var c=0;c<this.columns.length;c++){var cellValue=this.columns[c].name in cellValues?cellValues[this.columns[c].name]:"";rowData.columns.push(this.getTypedValue(c,cellValue))}this.data.push(rowData)}}return!0},EditableGrid.prototype.processColumns=function(){for(var e=0;e<this.columns.length;e++){var t=this.columns[e];t.columnIndex=e,t.editablegrid=this,this.parseColumnType(t),t.enumProvider||(t.enumProvider=t.optionValues?new EnumProvider:null),t.cellRenderer||this._createCellRenderer(t),t.headerRenderer||this._createHeaderRenderer(t),t.cellEditor||this._createCellEditor(t),t.headerEditor||this._createHeaderEditor(t),this._addDefaultCellValidators(t)}},EditableGrid.prototype.parseColumnType=function(e){if(e.unit=null,e.precision=-1,e.decimal_point=",",e.thousands_separator=".",e.unit_before_number=!1,e.nansymbol="",e.datatype.match(/(.*)\((.*),(.*),(.*),(.*),(.*),(.*)\)$/))e.datatype=RegExp.$1,e.unit=RegExp.$2,e.precision=parseInt(RegExp.$3),e.decimal_point=RegExp.$4,e.thousands_separator=RegExp.$5,e.unit_before_number=RegExp.$6,e.nansymbol=RegExp.$7,e.unit=e.unit.trim(),e.decimal_point=e.decimal_point.trim(),e.thousands_separator=e.thousands_separator.trim(),e.unit_before_number="1"==e.unit_before_number.trim(),e.nansymbol=e.nansymbol.trim();else if(e.datatype.match(/(.*)\((.*),(.*),(.*),(.*),(.*)\)$/))e.datatype=RegExp.$1,e.unit=RegExp.$2,e.precision=parseInt(RegExp.$3),e.decimal_point=RegExp.$4,e.thousands_separator=RegExp.$5,e.unit_before_number=RegExp.$6,e.unit=e.unit.trim(),e.decimal_point=e.decimal_point.trim(),e.thousands_separator=e.thousands_separator.trim(),e.unit_before_number="1"==e.unit_before_number.trim();else if(e.datatype.match(/(.*)\((.*),(.*),(.*)\)$/))e.datatype=RegExp.$1,e.unit=RegExp.$2.trim(),e.precision=parseInt(RegExp.$3),e.nansymbol=RegExp.$4.trim();else if(e.datatype.match(/(.*)\((.*),(.*)\)$/))e.datatype=RegExp.$1.trim(),e.unit=RegExp.$2.trim(),e.precision=parseInt(RegExp.$3);else if(e.datatype.match(/(.*)\((.*)\)$/)){e.datatype=RegExp.$1.trim();var t=RegExp.$2.trim();t.match(/^[0-9]*$/)?e.precision=parseInt(t):e.unit=t}"comma"==e.decimal_point&&(e.decimal_point=","),"dot"==e.decimal_point&&(e.decimal_point="."),"comma"==e.thousands_separator&&(e.thousands_separator=","),"dot"==e.thousands_separator&&(e.thousands_separator="."),isNaN(e.precision)&&(e.precision=-1),""==e.unit&&(e.unit=null),""==e.nansymbol&&(e.nansymbol=null)},EditableGrid.prototype.getTypedValue=function(e,t){if(null===t)return t;var r=this.getColumnType(e);return"boolean"==r&&(t=!(!t||0==t||"false"==t||"f"==t)),"integer"==r&&(t=parseInt(t,10)),"double"==r&&(t=parseFloat(t)),"string"==r&&(t=""+t),t},EditableGrid.prototype.attachToHTMLTable=function(e,t){if(this.data=[],this.dataUnfiltered=null,this.table=null,t){this.columns=t;for(var r=0;r<this.columns.length;r++)this.columns[r].optionValues=this._convertOptions(this.columns[r].optionValues);this.processColumns()}this.table="string"==typeof e?_$(e):e,this.table||console.error("Invalid table given: "+e),this.tHead=this.table.tHead,this.tBody=this.table.tBodies[0],this.tBody||(this.tBody=document.createElement("TBODY"),this.table.insertBefore(this.tBody,this.table.firstChild)),this.tHead||(this.tHead=document.createElement("THEAD"),this.table.insertBefore(this.tHead,this.tBody)),0==this.tHead.rows.length&&this.tBody.rows.length>0&&this.tHead.appendChild(this.tBody.rows[0]),this.nbHeaderRows=this.tHead.rows.length;for(var n=this.tHead.rows,i=0;i<n.length;i++)for(var o=n[i].cells,a=0,l=0;l<o.length&&a<this.columns.length;l++){this.columns[a].label&&this.columns[a].label!=this.columns[a].name||(this.columns[a].label=o[l].innerHTML);var d=parseInt(o[l].getAttribute("colspan"));a+=d>1?d:1}for(var n=this.tBody.rows,i=0;i<n.length;i++){for(var s=[],o=n[i].cells,l=0;l<o.length&&l<this.columns.length;l++)s.push(this.getTypedValue(l,o[l].innerHTML));this.data.push({visible:!0,originalIndex:i,id:n[i].id,columns:s}),n[i].rowId=n[i].id,n[i].id=this._getRowDOMId(n[i].id)}},EditableGrid.prototype._createCellRenderer=function(e){e.cellRenderer=e.enumProvider&&"list"==e.datatype&&"undefined"!=typeof MultiselectCellRenderer?new MultiselectCellRenderer:e.enumProvider?new EnumCellRenderer:"integer"==e.datatype||"double"==e.datatype?new NumberCellRenderer:"boolean"==e.datatype?new CheckboxCellRenderer:"email"==e.datatype?new EmailCellRenderer:"website"==e.datatype||"url"==e.datatype?new WebsiteCellRenderer:"date"==e.datatype?new DateCellRenderer:new CellRenderer,e.cellRenderer&&(e.cellRenderer.editablegrid=this,e.cellRenderer.column=e)},EditableGrid.prototype._createHeaderRenderer=function(e){e.headerRenderer=this.enableSort&&"html"!=e.datatype?new SortHeaderRenderer(e.name):new CellRenderer,e.headerRenderer&&(e.headerRenderer.editablegrid=this,e.headerRenderer.column=e)},EditableGrid.prototype._createCellEditor=function(e){e.cellEditor=e.enumProvider&&"list"==e.datatype&&"undefined"!=typeof MultiselectCellEditor?new MultiselectCellEditor:e.enumProvider?new SelectCellEditor:"integer"==e.datatype||"double"==e.datatype?new NumberCellEditor(e.datatype):"boolean"==e.datatype?null:"email"==e.datatype?new TextCellEditor(e.precision):"website"==e.datatype||"url"==e.datatype?new TextCellEditor(e.precision):"date"==e.datatype?"undefined"==typeof jQuery||"undefined"==typeof jQuery.datepicker?new TextCellEditor(e.precision,10):new DateCellEditor({fieldSize:e.precision,maxLength:10}):new TextCellEditor(e.precision),e.cellEditor&&(e.cellEditor.editablegrid=this,e.cellEditor.column=e)},EditableGrid.prototype._createHeaderEditor=function(e){e.headerEditor=new TextCellEditor,e.headerEditor&&(e.headerEditor.editablegrid=this,e.headerEditor.column=e)},EditableGrid.prototype.getRowCount=function(){return this.data.length},EditableGrid.prototype.getUnfilteredRowCount=function(){if(this.unfilteredRowCount>0)return this.unfilteredRowCount;var e=null==this.dataUnfiltered?this.data:this.dataUnfiltered;return e.length},EditableGrid.prototype.getTotalRowCount=function(){return this.totalRowCount>0?this.totalRowCount:this.getRowCount()},EditableGrid.prototype.getColumnCount=function(){return this.columns.length},EditableGrid.prototype.hasColumn=function(e){return this.getColumnIndex(e)>=0},EditableGrid.prototype.getColumn=function(e){var t=this.getColumnIndex(e);return t<0?(console.error("[getColumn] Column not found with index or name "+e),null):this.columns[t]},EditableGrid.prototype.getColumnName=function(e){return this.getColumn(e).name},EditableGrid.prototype.getColumnLabel=function(e){return this.getColumn(e).label},EditableGrid.prototype.getColumnType=function(e){return this.getColumn(e).datatype},EditableGrid.prototype.getColumnUnit=function(e){return this.getColumn(e).unit},EditableGrid.prototype.getColumnPrecision=function(e){return this.getColumn(e).precision},EditableGrid.prototype.isColumnBar=function(e){var t=this.getColumn(e);return t.bar&&t.isNumerical()},EditableGrid.prototype.getColumnStack=function(e){var t=this.getColumn(e);return t.isNumerical()?t.bar:""},EditableGrid.prototype.isColumnNumerical=function(e){var t=this.getColumn(e);return t.isNumerical()},EditableGrid.prototype.getValueAt=function(e,t){if(t<0||t>=this.columns.length)return console.error("[getValueAt] Invalid column index "+t),null;var r=this.columns[t];if(e<0)return r.label;if("undefined"==typeof this.data[e])return console.error("[getValueAt] Invalid row index "+e),null;var n=this.data[e].columns;return n?n[t]:null},EditableGrid.prototype.getDisplayValueAt=function(e,t){var r=this.getValueAt(e,t),n=e<0?this.columns[t].headerRenderer:this.columns[t].cellRenderer;return n.getDisplayValue(e,r)},EditableGrid.prototype.setValueAt=function(e,t,r,n){"undefined"==typeof n&&(n=!0);var i=null;if(t<0||t>=this.columns.length)return console.error("[setValueAt] Invalid column index "+t),null;var o=this.columns[t];if(e<0)i=o.label,o.label=r;else{if("undefined"==typeof this.data[e])return console.error("Invalid rowindex "+e),null;var a=this.data[e].columns;i=a[t],a&&(a[t]=this.getTypedValue(t,r))}if(n){var l=e<0?o.headerRenderer:o.cellRenderer,d=this.getCell(e,t);d&&l._render(e,t,d,r)}return i},EditableGrid.prototype.getColumnIndex=function(e){if("undefined"==typeof e||""===e)return-1;if(!isNaN(e)&&e>=0&&e<this.columns.length)return e;for(var t=0;t<this.columns.length;t++)if(this.columns[t].name==e)return t;return-1},EditableGrid.prototype.getRow=function(e){return e<0?this.tHead.rows[e+this.nbHeaderRows]:"undefined"==typeof this.data[e]?(console.error("[getRow] Invalid row index "+e),null):_$(this._getRowDOMId(this.data[e].id))},EditableGrid.prototype.getRowId=function(e){return e<0||e>=this.data.length?null:this.data[e].id},EditableGrid.prototype.getRowIndex=function(e){e="object"==typeof e?e.rowId:e;for(var t=0;t<this.data.length;t++)if(this.data[t].id==e)return t;return-1},EditableGrid.prototype.getRowAttribute=function(e,t){return"undefined"==typeof this.data[e]?(console.error("Invalid rowindex "+e),null):this.data[e][t]},EditableGrid.prototype.setRowAttribute=function(e,t,r){this.data[e][t]=r},EditableGrid.prototype._getRowDOMId=function(e){return null!=this.currentContainerid?this.name+"_"+e:e},EditableGrid.prototype.removeRow=function(e){return this.remove(this.getRowIndex(e))},EditableGrid.prototype.remove=function(e){var t=this.data[e].id,r=this.data[e].originalIndex,n=null==this.dataUnfiltered?this.data:this.dataUnfiltered,i=_$(this._getRowDOMId(t));null!=i&&this.tBody.removeChild(i);for(var o=0;o<n.length;o++)n[o].originalIndex>=r&&n[o].originalIndex--;if(this.data.splice(e,1),null!=this.dataUnfiltered)for(var o=0;o<this.dataUnfiltered.length;o++)if(this.dataUnfiltered[o].id==t){this.dataUnfiltered.splice(o,1);break}this.rowRemoved(e,t),this.refreshGrid()},EditableGrid.prototype.getRowValues=function(e){for(var t={},r=0;r<this.getColumnCount();r++)t[this.getColumnName(r)]=this.getValueAt(e,r);return t},EditableGrid.prototype.append=function(e,t,r,n){return this.insert(this.data.length,e,t,r,n)},EditableGrid.prototype.addRow=function(e,t,r,n){return this.append(e,t,r,n)},EditableGrid.prototype._insert=function(e,t,r,n,i,o){var a=null,l=0,d=null==this.dataUnfiltered?this.data:this.dataUnfiltered;if("undefined"!=typeof this.data[e]&&(a=this.data[e].id,l=this.data[e].originalIndex+t),null==this.currentContainerid){var s=this.tBody.insertRow(e+t);s.rowId=r,s.id=this._getRowDOMId(r);for(var u=0;u<this.columns.length;u++)s.insertCell(u)}var c={visible:!0,originalIndex:l,id:r};if(i)for(var p in i)c[p]=i[p];c.columns=[];for(var u=0;u<this.columns.length;u++){var h=this.columns[u].name in n?n[this.columns[u].name]:"";c.columns.push(this.getTypedValue(u,h))}for(var m=0;m<d.length;m++)d[m].originalIndex>=l&&d[m].originalIndex++;if(this.data.splice(e+t,0,c),null!=this.dataUnfiltered)if(null===a)this.dataUnfiltered.splice(e+t,0,c);else for(var m=0;m<this.dataUnfiltered.length;m++)if(this.dataUnfiltered[m].id==a){this.dataUnfiltered.splice(m+t,0,c);break}this.refreshGrid(),o||this.sort(),this.filter()},EditableGrid.prototype.insert=function(e,t,r,n,i){return e<0&&(e=0),e>=this.data.length&&this.data.length>0?this.insertAfter(this.data.length-1,t,r,n,i):this._insert(e,0,t,r,n,i)},EditableGrid.prototype.insertAfter=function(e,t,r,n,i){return e<0?this.insert(0,t,r,n,i):(e>=this.data.length&&(e=Math.max(0,this.data.length-1)),this._insert(e,1,t,r,n,i))},EditableGrid.prototype.setHeaderRenderer=function(e,t){var r=this.getColumnIndex(e);if(r<0)console.error("[setHeaderRenderer] Invalid column: "+e);else{var n=this.columns[r];n.headerRenderer=this.enableSort&&"html"!=n.datatype?new SortHeaderRenderer(n.name,t):t,t&&(this.enableSort&&"html"!=n.datatype&&(n.headerRenderer.editablegrid=this,n.headerRenderer.column=n),t.editablegrid=this,t.column=n)}},EditableGrid.prototype.setCellRenderer=function(e,t){var r=this.getColumnIndex(e);if(r<0)console.error("[setCellRenderer] Invalid column: "+e);else{var n=this.columns[r];n.cellRenderer=t,t&&(t.editablegrid=this,t.column=n)}},EditableGrid.prototype.setCellEditor=function(e,t){var r=this.getColumnIndex(e);if(r<0)console.error("[setCellEditor] Invalid column: "+e);else{var n=this.columns[r];n.cellEditor=t,t&&(t.editablegrid=this,t.column=n)}},EditableGrid.prototype.setHeaderEditor=function(e,t){var r=this.getColumnIndex(e);if(r<0)console.error("[setHeaderEditor] Invalid column: "+e);else{var n=this.columns[r];n.headerEditor=t,t&&(t.editablegrid=this,t.column=n)}},EditableGrid.prototype.setEnumProvider=function(e,t){var r=this.getColumnIndex(e);if(r<0)console.error("[setEnumProvider] Invalid column: "+e);else{var n=null!=this.columns[r].enumProvider;this.columns[r].enumProvider=t,n||(this._createCellRenderer(this.columns[r]),this._createCellEditor(this.columns[r]))}},EditableGrid.prototype.clearCellValidators=function(e){var t=this.getColumnIndex(e);t<0?console.error("[clearCellValidators] Invalid column: "+e):this.columns[t].cellValidators=[]},EditableGrid.prototype.addDefaultCellValidators=function(e){var t=this.getColumnIndex(e);return t<0&&console.error("[addDefaultCellValidators] Invalid column: "+e),this._addDefaultCellValidators(this.columns[t])},EditableGrid.prototype._addDefaultCellValidators=function(e){"integer"==e.datatype||"double"==e.datatype?e.cellValidators.push(new NumberCellValidator(e.datatype)):"email"==e.datatype?e.cellValidators.push(new EmailCellValidator):"website"==e.datatype||"url"==e.datatype?e.cellValidators.push(new WebsiteCellValidator):"date"==e.datatype&&e.cellValidators.push(new DateCellValidator(this))},EditableGrid.prototype.addCellValidator=function(e,t){var r=this.getColumnIndex(e);r<0?console.error("[addCellValidator] Invalid column: "+e):this.columns[r].cellValidators.push(t)},EditableGrid.prototype.setCaption=function(e){this.caption=e},EditableGrid.prototype.getCell=function(e,t){var r=this.getRow(e);return null==r?(console.error("[getCell] Invalid row index "+e),null):r.cells[t]},EditableGrid.prototype.getCellX=function(e){for(var t=0;null!=e&&this.isStatic(e);)try{t+=e.offsetLeft,e=e.offsetParent}catch(r){e=null}return t},EditableGrid.prototype.getCellY=function(e){for(var t=0;null!=e&&this.isStatic(e);)try{t+=e.offsetTop,e=e.offsetParent}catch(r){e=null}return t},EditableGrid.prototype.getScrollXOffset=function(e){for(var t=0;null!=e&&"undefined"!=typeof e.scrollLeft&&this.isStatic(e)&&e!=document.body;)try{t+=parseInt(e.scrollLeft),e=e.parentNode}catch(r){e=null}return t},EditableGrid.prototype.getScrollYOffset=function(e){for(var t=0;null!=e&&"undefined"!=typeof e.scrollTop&&this.isStatic(e)&&e!=document.body;)try{t+=parseInt(e.scrollTop),e=e.parentNode}catch(r){e=null}return t},EditableGrid.prototype._rendergrid=function(containerid,className,tableid){with(this){if(lastSelectedRowIndex=-1,_currentPageIndex=getCurrentPageIndex(),"undefined"!=typeof table&&null!=table){var _data=null==dataUnfiltered?data:dataUnfiltered;_renderHeaders();for(var rows=tBody.rows,skipped=0,displayed=0,rowIndex=0,i=0;i<rows.length;i++)if(!_data[i].visible||pageSize>0&&displayed>=pageSize)"none"!=rows[i].style.display&&(rows[i].style.display="none",rows[i].hidden_by_editablegrid=!0);else{if(skipped<pageSize*_currentPageIndex)skipped++,"none"!=rows[i].style.display&&(rows[i].style.display="none",rows[i].hidden_by_editablegrid=!0);else{displayed++;var cols=rows[i].cells;"undefined"!=typeof rows[i].hidden_by_editablegrid&&rows[i].hidden_by_editablegrid&&(rows[i].style.display="",rows[i].hidden_by_editablegrid=!1),rows[i].rowId=getRowId(rowIndex),rows[i].id=_getRowDOMId(rows[i].rowId);for(var j=0;j<cols.length&&j<columns.length;j++)columns[j].renderable&&columns[j].cellRenderer._render(rowIndex,j,cols[j],getValueAt(rowIndex,j))}rowIndex++}table.editablegrid=this,doubleclick?table.ondblclick=function(e){this.editablegrid.mouseClicked(e)}:table.onclick=function(e){this.editablegrid.mouseClicked(e)}}else{if(!containerid)return console.error("Container ID not specified (renderGrid not called yet ?)");if(!_$(containerid))return console.error("Unable to get element ["+containerid+"]");currentContainerid=containerid,currentClassName=className,currentTableid=tableid;var startRowIndex=0,endRowIndex=getRowCount();for(pageSize>0&&(startRowIndex=_currentPageIndex*pageSize,endRowIndex=Math.min(getRowCount(),startRowIndex+pageSize)),this.table=document.createElement("table"),table.className=className||"editablegrid","undefined"!=typeof tableid&&(table.id=tableid);_$(containerid).hasChildNodes();)_$(containerid).removeChild(_$(containerid).firstChild);if(_$(containerid).appendChild(table),caption){var captionElement=document.createElement("CAPTION");captionElement.innerHTML=this.caption,table.appendChild(captionElement)}this.tHead=document.createElement("THEAD"),table.appendChild(tHead);for(var trHeader=tHead.insertRow(0),columnCount=getColumnCount(),c=0;c<columnCount;c++){var headerCell=document.createElement("TH"),td=trHeader.appendChild(headerCell);columns[c].headerRenderer._render(-1,c,td,columns[c].label)}this.tBody=document.createElement("TBODY"),table.appendChild(tBody);for(var insertRowIndex=0,i=startRowIndex;i<endRowIndex;i++){var tr=tBody.insertRow(insertRowIndex++);for(tr.rowId=data[i].id,tr.id=this._getRowDOMId(data[i].id),j=0;j<columnCount;j++){var td=tr.insertCell(j);columns[j].cellRenderer._render(i,j,td,getValueAt(i,j))}}_$(containerid).editablegrid=this,doubleclick?_$(containerid).ondblclick=function(e){this.editablegrid.mouseClicked(e)}:_$(containerid).onclick=function(e){this.editablegrid.mouseClicked(e)}}tableRendered(containerid,className,tableid)}},EditableGrid.prototype.renderGrid=function(e,t,r){this._rendergrid(e,t,r),this.serverSide||(this.sort(),this.filter())},EditableGrid.prototype.refreshGrid=function(){null!=this.currentContainerid&&(this.table=null),this._rendergrid(this.currentContainerid,this.currentClassName,this.currentTableid)},EditableGrid.prototype._renderHeaders=function(){with(this)for(var rows=tHead.rows,i=0;i<1;i++)for(var rowData=[],cols=rows[i].cells,columnIndexInModel=0,j=0;j<cols.length&&columnIndexInModel<columns.length;j++){columns[columnIndexInModel].headerRenderer._render(-1,columnIndexInModel,cols[j],columns[columnIndexInModel].label);
var colspan=parseInt(cols[j].getAttribute("colspan"));columnIndexInModel+=colspan>1?colspan:1}},EditableGrid.prototype.mouseClicked=function(e){with(e=e||window.event,this){for(var target=e.target||e.srcElement;target&&"A"!=target.tagName&&"TD"!=target.tagName&&"TH"!=target.tagName;)target=target.parentNode;if(!target||!target.parentNode||!target.parentNode.parentNode||"TBODY"!=target.parentNode.parentNode.tagName&&"THEAD"!=target.parentNode.parentNode.tagName||target.isEditing)return;if("A"==target.tagName)return;var rowIndex=getRowIndex(target.parentNode),columnIndex=target.cellIndex;editCell(rowIndex,columnIndex)}},EditableGrid.prototype.editCell=function(rowIndex,columnIndex){var target=this.getCell(rowIndex,columnIndex);with(this){var column=columns[columnIndex];column&&(rowIndex>-1&&(rowSelected(lastSelectedRowIndex,rowIndex),lastSelectedRowIndex=rowIndex),column.editable?rowIndex<0?column.headerEditor&&isHeaderEditable(rowIndex,columnIndex)&&column.headerEditor.edit(rowIndex,columnIndex,target,column.label):column.cellEditor&&isEditable(rowIndex,columnIndex)&&column.cellEditor.edit(rowIndex,columnIndex,target,getValueAt(rowIndex,columnIndex)):readonlyWarning(column))}},EditableGrid.prototype.sortColumns=function(headerArray){with(this){newColumns=[],newColumnIndices=[];for(var i=0;i<headerArray.length;i++){if(columnIndex=this.getColumnIndex(headerArray[i]),columnIndex==-1)return console.error("[sortColumns] Invalid column: "+columnIndex),!1;newColumns[i]=this.columns[columnIndex],newColumnIndices[i]=columnIndex}this.columns=newColumns;for(var i=0;i<this.data.length;i++){for(var myData=this.data[i],myDataColumns=myData.columns,newDataColumns=[],j=0;j<myDataColumns.length;j++)newIndex=newColumnIndices[j],newDataColumns[j]=myDataColumns[newIndex];this.data[i].columns=newDataColumns}return!0}},EditableGrid.prototype.sort=function(columnIndexOrName,descending,backOnFirstPage){with(this){if("undefined"==typeof columnIndexOrName&&sortedColumnName===-1)return tableSorted(-1,sortDescending),!0;if("undefined"==typeof columnIndexOrName&&(columnIndexOrName=sortedColumnName),"undefined"==typeof descending&&(descending=sortDescending),localset("sortColumnIndexOrName",columnIndexOrName),localset("sortDescending",descending),serverSide)return backOnFirstPage?setPageIndex(0):refreshGrid();var columnIndex=columnIndexOrName;if(parseInt(columnIndex,10)!==-1&&(columnIndex=this.getColumnIndex(columnIndexOrName),columnIndex<0))return console.error("[sort] Invalid column: "+columnIndexOrName),!1;if(!enableSort)return void tableSorted(columnIndex,descending);var filterActive=null!=dataUnfiltered;filterActive&&(data=dataUnfiltered);for(var type=columnIndex<0?"":getColumnType(columnIndex),row_array=[],rowCount=getRowCount(),i=0;i<rowCount-(ignoreLastRow?1:0);i++)row_array.push([columnIndex<0?null:getDisplayValueAt(i,columnIndex),i,data[i].originalIndex]);var sort_function="integer"==type||"double"==type?sort_numeric:"boolean"==type?sort_boolean:"date"==type?sort_date:sort_alpha;row_array.sort(columnIndex<0?unsort:sort_stable(sort_function,descending)),ignoreLastRow&&row_array.push([columnIndex<0?null:getDisplayValueAt(rowCount-1,columnIndex),rowCount-1,data[rowCount-1].originalIndex]);var _data=data;data=[];for(var i=0;i<row_array.length;i++)data.push(_data[row_array[i][1]]);if(delete row_array,filterActive){dataUnfiltered=data,data=[];for(var r=0;r<rowCount;r++)dataUnfiltered[r].visible&&data.push(dataUnfiltered[r])}return backOnFirstPage?setPageIndex(0):refreshGrid(),tableSorted(columnIndex,descending),!0}},EditableGrid.prototype.filter=function(filterString,cols){with(this){if("undefined"!=typeof filterString&&(this.currentFilter=filterString,this.localset("filter",filterString)),serverSide)return setPageIndex(0);if(null==currentFilter||""==currentFilter){if(null!=dataUnfiltered){data=dataUnfiltered,dataUnfiltered=null;for(var r=0;r<getRowCount();r++)data[r].visible=!0;setPageIndex(0),tableFiltered()}return}var words=currentFilter.toLowerCase().split(" ");null!=dataUnfiltered&&(data=dataUnfiltered);for(var rowCount=getRowCount(),columnCount="undefined"!=typeof cols?cols.length:getColumnCount(),r=0;r<rowCount;r++){var row=data[r];row.visible=!0;for(var rowContent="",c=0;c<columnCount;c++)if("boolean"!=getColumnType(c)){var displayValue=getDisplayValueAt(r,"undefined"!=typeof cols?cols[c]:c),value=getValueAt(r,"undefined"!=typeof cols?cols[c]:c);rowContent+=displayValue+" "+(displayValue==value?"":value+" ")}for(var attributeName in row)"visible"!=attributeName&&"originalIndex"!=attributeName&&"columns"!=attributeName&&(rowContent+=row[attributeName]);for(var i=0;i<words.length;i++){var word=words[i],match=!1,invertMatch=word.startsWith("!");invertMatch&&(word=word.substr(1));var colindex=-1,attributeName=null;if(word.contains("!=")){var parts=word.split("!=");colindex=getColumnIndex(parts[0]),colindex>=0?(word=parts[1],invertMatch=!invertMatch):"undefined"!=typeof row[parts[0]]&&(attributeName=parts[0],word=parts[1],invertMatch=!invertMatch)}else if(word.contains("=")){var parts=word.split("=");colindex=getColumnIndex(parts[0]),colindex>=0?word=parts[1]:"undefined"!=typeof row[parts[0]]&&(attributeName=parts[0],word=parts[1])}if(word.endsWith("!"))if(word=word.substr(0,word.length-1),colindex>=0)match=(""+getDisplayValueAt(r,colindex)).trim().toLowerCase()==word||(""+getValueAt(r,colindex)).trim().toLowerCase()==word;else if(null!==attributeName)match=(""+getRowAttribute(r,attributeName)).trim().toLowerCase()==word;else for(var c=0;c<columnCount;c++)"boolean"!=getColumnType("undefined"!=typeof cols?cols[c]:c)&&((""+getDisplayValueAt(r,"undefined"!=typeof cols?cols[c]:c)).trim().toLowerCase()!=word&&(""+getValueAt(r,"undefined"!=typeof cols?cols[c]:c)).trim().toLowerCase()!=word||(match=!0));else match=colindex>=0?(getValueAt(r,colindex)+" "+getDisplayValueAt(r,colindex)).trim().toLowerCase().indexOf(word)>=0:null!==attributeName?(""+getRowAttribute(r,attributeName)).trim().toLowerCase().indexOf(word)>=0:rowContent.toLowerCase().indexOf(word)>=0;if(invertMatch?match:!match){data[r].visible=!1;break}}}dataUnfiltered=data,data=[];for(var r=0;r<rowCount;r++)dataUnfiltered[r].visible&&data.push(dataUnfiltered[r]);setPageIndex(0),tableFiltered()}},EditableGrid.prototype.setPageSize=function(e){this.pageSize=parseInt(e),isNaN(this.pageSize)&&(this.pageSize=0),this.currentPageIndex=0,this.refreshGrid()},EditableGrid.prototype.getPageCount=function(){return 0==this.getRowCount()?0:this.pageCount>0?this.pageCount:this.pageSize<=0?1:Math.ceil(this.getRowCount()/this.pageSize)},EditableGrid.prototype.getCurrentPageIndex=function(){return this.pageSize<=0&&!this.serverSide?0:Math.max(0,this.currentPageIndex>=this.getPageCount()?this.getPageCount()-1:this.currentPageIndex)},EditableGrid.prototype.setPageIndex=function(e){this.currentPageIndex=e,this.localset("pageIndex",e),this.refreshGrid()},EditableGrid.prototype.prevPage=function(){this.canGoBack()&&this.setPageIndex(this.getCurrentPageIndex()-1)},EditableGrid.prototype.firstPage=function(){this.canGoBack()&&this.setPageIndex(0)},EditableGrid.prototype.nextPage=function(){this.canGoForward()&&this.setPageIndex(this.getCurrentPageIndex()+1)},EditableGrid.prototype.lastPage=function(){this.canGoForward()&&this.setPageIndex(this.getPageCount()-1)},EditableGrid.prototype.canGoBack=function(){return this.getCurrentPageIndex()>0},EditableGrid.prototype.canGoForward=function(){return this.getCurrentPageIndex()<this.getPageCount()-1},EditableGrid.prototype.getSlidingPageInterval=function(e){var t=this.getPageCount();if(t<=1)return null;var r=this.getCurrentPageIndex(),n=Math.max(0,r-Math.floor(e/2)),i=Math.min(t-1,r+Math.floor(e/2));if(i-n<e){var o=e-(i-n+1);n=Math.max(0,n-o),i=Math.min(t-1,i+o)}return{startPageIndex:n,endPageIndex:i}},EditableGrid.prototype.getPagesInInterval=function(e,t){for(var r=[],n=e.startPageIndex;n<=e.endPageIndex;n++)r.push("function"==typeof t?t(n,n==this.getCurrentPageIndex()):n);return r};