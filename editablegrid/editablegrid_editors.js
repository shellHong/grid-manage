function CellEditor(e){this.init(e)}function TextCellEditor(e,t,i){e&&(this.fieldSize=e),t&&(this.maxLength=t),i&&this.init(i)}function NumberCellEditor(e,t){this.type=e,this.init(t)}function SelectCellEditor(e){this.minWidth=75,this.minHeight=22,this.adaptHeight=!0,this.adaptWidth=!0,this.init(e)}function DateCellEditor(e){this.init(e)}CellEditor.prototype.init=function(e){if(e)for(var t in e)this[t]=e[t]},CellEditor.prototype.edit=function(e,t,i,l){i.isEditing=!0,i.rowIndex=e,i.columnIndex=t;var o=this.getEditor(i,l);return!!o&&(o.element=i,o.celleditor=this,o.onkeydown=function(e){if(e=e||window.event,13==e.keyCode||9==e.keyCode){if(this.onblur_backup=this.onblur,this.onblur=null,this.celleditor.applyEditing(this.element,this.celleditor.getEditorValue(this))===!1&&(this.onblur=this.onblur_backup),9==e.keyCode&&this.element.rowIndex>=0&&this.celleditor.editablegrid.getColumnCount()>0&&this.celleditor.editablegrid.getRowCount()>0)for(var t=this.element.rowIndex,i=this.element.columnIndex;;){i<this.celleditor.editablegrid.getColumnCount()-1?i++:(t++,i=0),this.celleditor.editablegrid.getRow(t)||(t=0);var l=this.celleditor.editablegrid.getColumn(i);if(l.editable&&"boolean"!=l.datatype&&this.celleditor.editablegrid.isEditable(t,i)){this.celleditor.editablegrid.editCell(t,i);break}if(t==this.element.rowIndex&&i==this.element.columnIndex)break}return!1}if(27==e.keyCode)return this.onblur=null,this.celleditor.cancelEditing(this.element),!1},this.editablegrid.allowSimultaneousEdition||(o.onblur=this.editablegrid.saveOnBlur?function(e){this.onblur_backup=this.onblur,this.onblur=null,this.celleditor.applyEditing(this.element,this.celleditor.getEditorValue(this))===!1&&(this.onblur=this.onblur_backup)}:function(e){this.onblur=null,this.celleditor.cancelEditing(this.element)}),this.displayEditor(i,o),void this.autoFocus(o))},CellEditor.prototype.autoFocus=function(e){e.focus()},CellEditor.prototype.getEditor=function(e,t){return null},CellEditor.prototype.getEditorValue=function(e){return e.value},CellEditor.prototype.formatValue=function(e){return e},CellEditor.prototype.displayEditor=function(e,t,i,l){if(t.style.fontFamily=this.editablegrid.getStyle(e,"fontFamily","font-family"),t.style.fontSize=this.editablegrid.getStyle(e,"fontSize","font-size"),"static"==this.editablegrid.editmode){for(;e.hasChildNodes();)e.removeChild(e.firstChild);e.appendChild(t)}if("absolute"==this.editablegrid.editmode){e.appendChild(t),t.style.position="absolute";var o=this.editablegrid.paddingLeft(e),d=this.editablegrid.paddingTop(e),r=this.editablegrid.getScrollXOffset(e),n=this.editablegrid.getScrollYOffset(e),a="middle"==this.editablegrid.verticalAlign(e)?(e.offsetHeight-t.offsetHeight)/2-d:0;if(t.style.left=this.editablegrid.getCellX(e)-r+o+(i?i:0)+"px",t.style.top=this.editablegrid.getCellY(e)-n+d+a+(l?l:0)+"px","integer"==this.column.datatype||"double"==this.column.datatype){var s=this.editablegrid.getCellX(e)-r+e.offsetWidth-(parseInt(t.style.left)+t.offsetWidth);t.style.left=parseInt(t.style.left)+s+"px",t.style.textAlign="right"}}if("fixed"==this.editablegrid.editmode){for(var u=_$(this.editablegrid.editorzoneid);u.hasChildNodes();)u.removeChild(u.firstChild);u.appendChild(t)}e&&e.isEditing&&this.editablegrid.openedCellEditor&&this.editablegrid.openedCellEditor(e.rowIndex,e.columnIndex)},CellEditor.prototype._clearEditor=function(e){if(e.isEditing=!1,"fixed"==this.editablegrid.editmode)for(var t=_$(this.editablegrid.editorzoneid);t.hasChildNodes();)t.removeChild(t.firstChild)},CellEditor.prototype.cancelEditing=function(element){with(this)if(element&&element.isEditing){var renderer=this==column.headerEditor?column.headerRenderer:column.cellRenderer;renderer._render(element.rowIndex,element.columnIndex,element,editablegrid.getValueAt(element.rowIndex,element.columnIndex)),_clearEditor(element)}},CellEditor.prototype.applyEditing=function(element,newValue){with(this){if(element&&element.isEditing){if(!column.isValid(newValue))return!1;var formattedValue=formatValue(newValue),previousValue=editablegrid.setValueAt(element.rowIndex,element.columnIndex,formattedValue),newValue=editablegrid.getValueAt(element.rowIndex,element.columnIndex);return this.editablegrid.isSame(newValue,previousValue)||editablegrid.modelChanged(element.rowIndex,element.columnIndex,previousValue,newValue,editablegrid.getRow(element.rowIndex)),_clearEditor(element),!0}return!1}},TextCellEditor.prototype=new CellEditor,TextCellEditor.prototype.fieldSize=-1,TextCellEditor.prototype.maxLength=-1,TextCellEditor.prototype.autoHeight=!0,TextCellEditor.prototype.editorValue=function(e){return e},TextCellEditor.prototype.updateStyle=function(e){this.column.isValid(this.getEditorValue(e))?this.editablegrid.removeClassName(e,this.editablegrid.invalidClassName):this.editablegrid.addClassName(e,this.editablegrid.invalidClassName)},TextCellEditor.prototype.getEditor=function(e,t){var i=document.createElement("input");i.setAttribute("type","text"),this.maxLength>0&&i.setAttribute("maxlength",this.maxLength),this.fieldSize>0?i.setAttribute("size",this.fieldSize):i.style.width=this.editablegrid.autoWidth(e)+"px";var l=this.editablegrid.autoHeight(e);return this.autoHeight&&(i.style.height=l+"px"),i.value=this.editorValue(t),i.onkeyup=function(e){this.celleditor.updateStyle(this)},i},TextCellEditor.prototype.displayEditor=function(e,t){CellEditor.prototype.displayEditor.call(this,e,t,-1*this.editablegrid.borderLeft(t),-1*(this.editablegrid.borderTop(t)+1)),this.updateStyle(t),t.select()},NumberCellEditor.prototype=new TextCellEditor((-1),32),NumberCellEditor.prototype.editorValue=function(e){return null===e||isNaN(e)?"":(e+"").replace(".",this.column.decimal_point)},NumberCellEditor.prototype.getEditorValue=function(e){return e.value.replace(",",".")},NumberCellEditor.prototype.formatValue=function(e){return"integer"==this.type?parseInt(e):parseFloat(e)},SelectCellEditor.prototype=new CellEditor,SelectCellEditor.prototype.isValueSelected=function(e,t,i){return!t&&!i||t==i},SelectCellEditor.prototype.getEditor=function(e,t){var i=this,l=document.createElement("select");this.adaptWidth&&"undefined"==typeof jQuery.fn.select2&&(l.style.width=Math.max(this.minWidth,this.editablegrid.autoWidth(e))+"px"),this.adaptHeight&&"undefined"==typeof jQuery.fn.select2&&(l.style.height=Math.max(this.minHeight,this.editablegrid.autoHeight(e))+"px");for(var o=this.column.getOptionValuesForEdit(e.rowIndex),d=0,r=!1,n=0;n<o.length;n++){var a=o[n];if("object"==typeof a.values){var s=document.createElement("optgroup");s.label=a.label,l.appendChild(s);for(var u=0;u<a.values.length;u++){var h=a.values[u],c=document.createElement("option");c.text=h.label,c.value=h.value?h.value:"",s.appendChild(c),this.isValueSelected(l,h.value,t)?(c.selected=!0,r=!0):c.selected=!1,d++}}else{var c=document.createElement("option");c.text=a.label,c.value=a.value?a.value:"";try{l.add(c,null)}catch(p){l.add(c)}this.isValueSelected(l,a.value,t)?(c.selected=!0,r=!0):c.selected=!1,d++}}if(!r){var c=document.createElement("option");c.text=t?t:"",c.value=t?t:"";try{l.add(c,l.options[0])}catch(p){l.add(c)}l.selectedIndex=0}return l.onchange=function(e){this.onblur=null,this.celleditor.applyEditing(this.element,i.getEditorValue(this))},l},SelectCellEditor.prototype.displayEditor=function(e,t){CellEditor.prototype.displayEditor.call(this,e,t),"undefined"!=typeof jQuery.fn.select2&&(t.onblur=null,t.onchange=null,jQuery(t).select2({dropdownAutoWidth:!0,minimumResultsForSearch:10}),jQuery(t).siblings("span.select2-container").css("position","absolute").css("left",t.style.left),jQuery(t).select2("open"),jQuery(t).on("select2:close",function(){this.celleditor.applyEditing(this.element,this.celleditor.getEditorValue(this))}).on("select2-blur",function(){this.celleditor.applyEditing(this.element,this.celleditor.getEditorValue(this))}).on("select2-close",function(){this.celleditor.applyEditing(this.element,this.celleditor.getEditorValue(this))}))},SelectCellEditor.prototype.autoFocus=function(e){return"undefined"!=typeof jQuery.fn.select2||CellEditor.prototype.autoFocus.call(this,e)},SelectCellEditor.prototype.getEditorValue=function(e){return"undefined"!=typeof jQuery.fn.select2?jQuery(e).val():CellEditor.prototype.getEditorValue.call(this,e)},SelectCellEditor.prototype.cancelEditing=function(e){"undefined"!=typeof jQuery.fn.select2&&jQuery(e).find("select").select2("destroy"),CellEditor.prototype.cancelEditing.call(this,e)},DateCellEditor.prototype=new TextCellEditor,DateCellEditor.prototype.displayEditor=function(e,t){TextCellEditor.prototype.displayEditor.call(this,e,t),jQuery(t).datepicker({dateFormat:"EU"==this.editablegrid.dateFormat?"dd/mm/yy":"mm/dd/yy",changeMonth:!0,changeYear:!0,yearRange:"c-100:c+10",beforeShow:function(){this.onblur_backup=this.onblur,this.onblur=null},onClose:function(e){""!=e?this.celleditor.applyEditing(t.element,e):null!=this.onblur_backup&&this.onblur_backup()}}).datepicker("show")};